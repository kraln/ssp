<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Schießstand-Piepser-Bedienpult</title><style>body{font-family:Arial,sans-serif;margin:0;padding:0;background-color:#f4f4f4}header{background-color:#007bff;color:#fff;padding:10px 20px;text-align:center}@keyframes flash{0%{background-color:#fff}50%{background-color:#ff0}100%{background-color:#007bff}}.flash-once{animation:flash .5s}#statusIndicator{margin-top:5px;font-size:18px}button{font-size:16px;padding:1.3em 3em;color:#fff;border:none;cursor:pointer}#smBtns button{font-size:12px;padding 0.6em 1.0em;margin:2px}</style><header id=headerElement><h1 id=currentPhase>&nbsp;</h1></header><section id=mainControl style=padding:20px;text-align:center><div id=main_controls><div class=schedule-selector style=margin-bottom:20px><label for=scheduleDropdown style=font-size:16px;margin-right:10px>Ablauf Wählen: </label><select id=scheduleDropdown style="font-size:16px;padding:5px 10px"></select></div><button id=startButton style=background-color:#28a745>Start</button>
<button id=stopButton style=background-color:#dc3545>Stop</button><div id=statusIndicator>Status: Bereit</div></div></section><section id=liveTiming style=background-color:#fff;padding:20px;text-align:center><h2 style=color:#333>Aktuelle Ablauf</h2><p style=font-size:16px>Verstrichene Zeit: <span id=timeElapsed style=font-weight:700>00:00:00</span><p style=font-size:16px>Verbleibende Zeit der Phase: <span id=timeRemaining style=font-weight:700>00:00:00</span></section><section id=scheduleManagement style=padding:20px;text-align:center><h2 style=color:#333>Abläufe Verwalten</h2><div id=scheduleButtons><button id=editScheduleButton class=btn style=background-color:#007bff>Aktuelle Ablauf Bearbeiten</button>
<button id=addNewScheduleButton class=btn style=background-color:#17a2b8>Ablauf Hinzufugen</button><br><br><button id=deleteScheduleButton class=btn style=background-color:#b81734>Aktuelle Ablauf Löschen</button></div></section><div id=scheduleModal style=display:none;position:fixed;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5)><div style="background-color:#fff;margin:100px auto;padding:20px;width:90%;max-width:600px"><h2 id=modalTitle>Ablauf Bearbeiten</h2><form id=scheduleForm><label for=scheduleName>Ablauf Name:</label>
<input id=scheduleName name=scheduleName required style=width:100%><h3>Phasen</h3><div id=phasesContainer></div><div id=smBtns><button type=button onclick=addPhase()>Phase Hinzufugen</button>
<button type=button onclick=addBeep()>Piep Hinzufugen</button>
<button type=button onclick=addPause()>Pause Hinzufugen</button></div><br><button>Ablauf Speichern</button></form><br><br><button onclick=closeModal()>Schließen</button></div></div><script>document.addEventListener("DOMContentLoaded",function(){loadSchedules(),document.getElementById("startButton").addEventListener("click",startSchedule),document.getElementById("stopButton").addEventListener("click",stopSchedule),document.getElementById("addNewScheduleButton").addEventListener("click",addNewSchedule),document.getElementById("editScheduleButton").addEventListener("click",editCurrentSchedule),document.getElementById("deleteScheduleButton").addEventListener("click",function(){const e=document.getElementById("scheduleDropdown").value;deleteSchedule(e)}),updateStatus("Ready")});function updateStatus(e){e=="Running"?(document.getElementById("startButton").hidden=!0,document.getElementById("stopButton").hidden=!1):(document.getElementById("startButton").hidden=!1,document.getElementById("stopButton").hidden=!0),document.getElementById("statusIndicator").textContent=""}function startSchedule(){const e=document.getElementById("scheduleDropdown").value;if(!e){alert("Bitte zuerst einen Ablauf wählen.");return}const t=findScheduleByName(e);if(!t){alert("Gewählte Ablauf nicht gefunden!");return}updateStatus("Running"),disableControls(!0),executeSchedule(t.phases)}function findScheduleByName(e){const t=loadFromLocalStorage();return t.find(t=>t.name===e)}function disableControls(e){document.getElementById("startButton").disabled=e,document.getElementById("stopButton").disabled=!e,document.getElementById("scheduleDropdown").disabled=e}function stopSchedule(){window.activeInterval&&(clearInterval(window.activeInterval),window.activeInterval=null),document.getElementById("timeElapsed").textContent="00:00:00",document.getElementById("currentPhase").textContent="\xa0",document.getElementById("timeRemaining").textContent="00:00:00",updateStatus("Stopped"),disableControls(!1)}function executeSchedule(e){let n=0,s=Date.now();function t(){let i=Date.now();if(n>=e.length){finishSchedule();return}const o=e[n++];if(o.type=="beep")fetch("/H"),setTimeout(function(){fetch("/L")},o.duration),t();else if(o.type=="pause")setTimeout(function(){t()},o.duration);else{var a=document.getElementById("headerElement");a.classList.add("flash-once"),setTimeout(function(){a.classList.remove("flash-once")},500),document.getElementById("currentPhase").textContent=o.phase,document.getElementById("timeRemaining").textContent=formatTime(o.duration),window.activeInterval=setInterval(()=>{document.getElementById("timeElapsed").textContent=formatTime(Math.round(Date.now()-s)),document.getElementById("timeRemaining").textContent=formatTime(Math.round(Date.now()-(i+o.duration*1e3))),(Date.now()-i)/1e3>o.duration&&(clearInterval(window.activeInterval),t())},13)}}t()}function formatTime(e){e<0&&(e*=-1);const t=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3),s=Math.floor(e%6e7/10)%100;return[t,n,s].map(e=>e<10?"0"+e:e).join(":")}function finishSchedule(){updateStatus("Complete"),document.getElementById("timeRemaining").textContent=formatTime(0),document.getElementById("currentPhase").textContent="\xa0",disableControls(!1)}function addNewSchedule(){document.getElementById("scheduleModal").style.display="block",document.getElementById("modalTitle").textContent="Ablauf Hinzufugen",document.getElementById("scheduleName").value="";const e=document.getElementById("phasesContainer");e.innerHTML}function addPhase(){const t=document.getElementById("phasesContainer"),e=document.createElement("div");e.className="phaseInput",e.innerHTML=`
        <label for="phaseName">Phase Name:</label>
        <input type="text" name="phaseName" required>
        <input type="hidden" name="phaseType" value="named"/>
        <label for="phaseDuration">Dauer (Sekunden):</label>
        <input type="number" name="phaseDuration" min="1" required>
    `,t.appendChild(e)}function addBeep(){const t=document.getElementById("phasesContainer"),e=document.createElement("div");e.className="phaseInput",e.innerHTML=`
        Piep<input type="hidden" name="phaseName" value="Piep"/>
        <input type="hidden" name="phaseType" value="beep"/>
        <label for="phaseDuration">Dauer (Millisekunden):</label>
        <input type="number" name="phaseDuration" min="10" required>
    `,t.appendChild(e)}function addPause(){const t=document.getElementById("phasesContainer"),e=document.createElement("div");e.className="phaseInput",e.innerHTML=`
        Pause<input type="hidden" name="phaseName" value="Pause"/>
        <input type="hidden" name="phaseType" value="pause"/>
        <label for="phaseDuration">Dauer (Millisekunden):</label>
        <input type="number" name="phaseDuration" min="10" required>
    `,t.appendChild(e)}document.getElementById("scheduleForm").addEventListener("submit",function(e){e.preventDefault(),saveNewOrEditSchedule()});function editCurrentSchedule(){const n=document.getElementById("scheduleDropdown").value,e=findScheduleByName(n);if(!e){alert("Ablauf nicht gefunden!");return}document.getElementById("scheduleModal").style.display="block",document.getElementById("modalTitle").textContent="Ablauf Bearbeiten",document.getElementById("scheduleName").value=e.name;const t=document.getElementById("phasesContainer");t.innerHTML="",e.phases.forEach(e=>{const n=document.createElement("div");n.className="phaseInput";let s=e.type!="named"?10:1,o=e.type!="named"?"Millisekunden":"Sekunden",i=e.type=="named"?`
             <label for="phaseName">Phase Name:</label>
            <input type="text" name="phaseName" value="${e.phase}" required>`:`${e.phase}<input type="hidden" name="phaseName" value="${e.phase} />`;n.innerHTML=`${i}
            <input type="hidden" name="phaseType" value="${e.type}" />
            <label for="phaseDuration">Dauer (${o}):</label>
            <input type="number" name="phaseDuration" value="${e.duration}" min="${s}" required>
        `,t.appendChild(n)})}function saveNewOrEditSchedule(){const n=document.getElementById("scheduleForm"),i=n.classList.contains("edit"),t=n.scheduleName.value,s=Array.from(document.querySelectorAll(".phaseInput")).map(e=>({phase:e.querySelector('[name="phaseName"]').value,type:e.querySelector('[name="phaseType"]').value,duration:parseInt(e.querySelector('[name="phaseDuration"]').value,10)})),e=loadFromLocalStorage(),o=e.findIndex(e=>e.name===t);o>-1?e[o]={name:t,phases:s}:e.push({name:t,phases:s}),saveToLocalStorage(e),closeModal(),loadSchedules()}function closeModal(){document.getElementById("scheduleModal").style.display="none",document.getElementById("scheduleForm").classList.remove("edit")}function deleteSchedule(e){if(!confirm('Sind Sie sicher, dass das "'+e+'" Ablauf gelöscht sein sollte?'))return;const t=loadFromLocalStorage(),n=t.filter(t=>t.name!==e);saveToLocalStorage(n),loadSchedules()}function saveToLocalStorage(e){localStorage.setItem("schedules",JSON.stringify(e))}function loadSchedules(){const t=loadFromLocalStorage();let e=document.getElementById("scheduleDropdown");e.innerHTML="",t.forEach(t=>{let n=document.createElement("option");n.value=t.name,n.textContent=t.name,e.appendChild(n)})}function loadFromLocalStorage(){return JSON.parse(localStorage.getItem("schedules")||"[]")}</script>